<ion-header>
  <ion-toolbar color="light">
    <ion-buttons slot="start"><ion-menu-button></ion-menu-button></ion-buttons>
    <ion-title>Borrowing Records</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  <div class="container-fluid">
    <div class="row g-3">
      <div class="col-12 col-md-6 col-lg-4" *ngFor="let r of (borrows$ | async)">
        <div class="card h-100 shadow-sm borrow-card">
          <!-- Card Header with Status Badge -->
          <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
            <h6 class="mb-0 fw-bold">Record #{{ r.id }}</h6>
            <span class="badge bg-light text-dark">
              {{ r.dueAt | date:'MMM d' }}
            </span>
          </div>
          
          <!-- Card Body -->
          <div class="card-body">
            <!-- Book Info -->
            <div class="mb-3">
              <div class="d-flex align-items-start">
                <i class="bi bi-book-fill text-primary me-2 fs-5"></i>
                <div>
                  <h5 class="card-title mb-1">{{ r.book?.title }}</h5>
                  <p class="text-muted mb-0 small">
                    <i class="bi bi-person-fill"></i> {{ r.book?.author }}
                  </p>
                </div>
              </div>
            </div>

            <hr>

            <!-- Borrower Info -->
            <div class="mb-3">
              <p class="mb-1">
                <strong class="text-secondary">
                  <i class="bi bi-person-badge-fill"></i> Borrower:
                </strong>
              </p>
              <p class="mb-0">{{ r.borrower }}</p>
            </div>

            <!-- Dates Info -->
            <div class="row g-2 small">
              <div class="col-6">
                <div class="p-2 bg-light rounded">
                  <p class="mb-0 text-muted">
                    <i class="bi bi-calendar-check"></i> Borrowed
                  </p>
                  <p class="mb-0 fw-bold">{{ r.borrowedAt | date:'shortDate' }}</p>
                </div>
              </div>
              <div class="col-6">
                <div class="p-2 bg-light rounded">
                  <p class="mb-0 text-muted">
                    <i class="bi bi-calendar-x"></i> Due Date
                  </p>
                  <p class="mb-0 fw-bold">{{ r.dueAt | date:'shortDate' }}</p>
                </div>
              </div>
            </div>
          </div>

          <!-- Card Footer with Actions -->
          <div class="card-footer bg-transparent border-top">
            <div class="d-flex gap-2 justify-content-between">
              <button 
                class="btn btn-sm btn-outline-primary flex-fill"
                (click)="editBorrow(r)">
                <i class="bi bi-pencil-fill"></i> Edit
              </button>
              <button 
                class="btn btn-sm btn-outline-success flex-fill"
                (click)="dueBorrow(r)">
                <i class="bi bi-check-circle-fill"></i> Return
              </button>
              <button 
                class="btn btn-sm btn-outline-danger"
                (click)="deleteBorrow(r)">
                <i class="bi bi-trash-fill"></i>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Empty State -->
    <div *ngIf="!(borrows$ | async)?.length" class="text-center py-5">
      <i class="bi bi-inbox fs-1 text-muted"></i>
      <h4 class="mt-3 text-muted">No borrowing records found</h4>
      <p class="text-muted">Start by borrowing some books!</p>
    </div>
  </div>
</ion-content>